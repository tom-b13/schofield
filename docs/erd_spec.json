{
  "version": "0.3",
  "conventions": {
    "db_case": "snake_case",
    "entities_case": "CamelCase",
    "placeholder_format": "UPPERCASE_UNDERSCORE",
    "enums": {
      "answer_kind": [
        "boolean",
        "enum_single",
        "long_text",
        "number",
        "short_string"
      ]
    }
  },
  "entities": [
    {
      "name": "Company",
      "pk": {
        "company_id": "uuid:not_null"
      },
      "fields": {
        "legal_name": "text:not_null",
        "registered_office_address": "text",
        "created_at": "timestamptz:not_null",
        "updated_at": "timestamptz"
      }
    },
    {
      "name": "QuestionnaireQuestion",
      "pk": {
        "question_id": "uuid:not_null"
      },
      "fields": {
        "external_qid": "text",
        "question_text": "text:not_null",
        "answer_type": "enum:answer_kind:not_null",
        "placeholder_code": "text",
        "mandatory": "boolean:not_null",
        "parent_question_id": "uuid -> QuestionnaireQuestion.question_id",
        "visible_if_value": "text"
      },
      "uniques": [
        "external_qid",
        "(placeholder_code) where placeholder_code is not null"
      ],
      "indexes": [
        "parent_question_id"
      ]
    },
    {
      "name": "AnswerOption",
      "pk": {
        "option_id": "uuid:not_null"
      },
      "fields": {
        "question_id": "uuid:not_null -> QuestionnaireQuestion.question_id",
        "value": "text:not_null",
        "label": "text",
        "sort_index": "int:not_null"
      },
      "uniques": [
        "(question_id,value)"
      ],
      "indexes": [
        "question_id"
      ]
    },
    {
      "name": "FieldGroup",
      "pk": {
        "field_group_id": "uuid:not_null"
      },
      "fields": {
        "group_key": "text:not_null",
        "label": "text:not_null",
        "description": "text",
        "is_active": "boolean:not_null"
      },
      "uniques": [
        "group_key"
      ]
    },
    {
      "name": "QuestionToFieldGroup",
      "pk": {
        "q2fg_id": "uuid:not_null"
      },
      "fields": {
        "question_id": "uuid:not_null -> QuestionnaireQuestion.question_id",
        "field_group_id": "uuid:not_null -> FieldGroup.field_group_id",
        "notes": "text"
      },
      "uniques": [
        "(question_id,field_group_id)"
      ],
      "indexes": [
        "question_id",
        "field_group_id"
      ]
    },
    {
      "name": "ResponseSet",
      "pk": {
        "response_set_id": "uuid:not_null"
      },
      "fields": {
        "company_id": "uuid:not_null -> Company.company_id",
        "created_at": "timestamptz:not_null",
        "created_by": "text"
      },
      "indexes": [
        "company_id",
        "created_at"
      ]
    },
    {
      "name": "Response",
      "pk": {
        "response_id": "uuid:not_null"
      },
      "fields": {
        "response_set_id": "uuid:not_null -> ResponseSet.response_set_id",
        "question_id": "uuid:not_null -> QuestionnaireQuestion.question_id",
        "value_json": "jsonb:not_null",
        "value_text": "text",
        "value_number": "numeric",
        "value_bool": "boolean",
        "option_id": "uuid -> AnswerOption.option_id"
      },
      "uniques": [
        "(response_set_id,question_id)"
      ],
      "indexes": [
        "response_set_id",
        "question_id",
        "option_id"
      ]
    },
    {
      "name": "GroupValue",
      "pk": {
        "group_value_id": "uuid:not_null"
      },
      "fields": {
        "response_set_id": "uuid:not_null -> ResponseSet.response_set_id",
        "field_group_id": "uuid:not_null -> FieldGroup.field_group_id",
        "value_json": "jsonb:not_null",
        "value_text": "text",
        "value_number": "numeric",
        "value_bool": "boolean",
        "option_id": "uuid -> AnswerOption.option_id",
        "source_question_id": "uuid -> QuestionnaireQuestion.question_id",
        "updated_at": "timestamptz:not_null"
      },
      "uniques": [
        "(response_set_id,field_group_id)"
      ],
      "indexes": [
        "response_set_id",
        "field_group_id",
        "source_question_id"
      ]
    },
    {
      "name": "GeneratedDocument",
      "pk": {
        "generated_document_id": "uuid:not_null"
      },
      "fields": {
        "response_set_id": "uuid:not_null -> ResponseSet.response_set_id",
        "output_uri": "text:not_null",
        "created_at": "timestamptz:not_null"
      },
      "indexes": [
        "response_set_id",
        "created_at"
      ]
    }
  ],
  "notes": [
    "Single handbook template parsed at merge; no template/mapping tables are persisted.",
    "Mapping is on QuestionnaireQuestion.placeholder_code with partial unique index.",
    "answer_kind includes enum_single for single-choice questions."
  ]
}
