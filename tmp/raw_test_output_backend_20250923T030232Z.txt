============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-8.4.1, pluggy-1.6.0
rootdir: /home/codex/schofield
plugins: mock-3.14.1, anyio-4.9.0, cov-6.2.1, langsmith-0.4.1
collected 202 items

tests/architectural/test_epic_a_data_model_architecture.py .FFFF...FFFFF [  6%]
FFFFF.FF.FFFFF                                                           [ 13%]
tests/functional/test_epic_a_data_model_functional.py FFFFFFFFFFFFFFFFFF [ 22%]
FFFFFFFFsFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF [ 57%]
FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF [ 93%]
FFFFFFFFFFFFF                                                            [100%]

=================================== FAILURES ===================================
_______________ test_entities_declare_explicit_field_collections _______________

    def test_entities_declare_explicit_field_collections() -> None:
        """Verifies 7.1.2 — each entity declares fields[] with name and type."""
        erd = _read_json(DOCS / "erd_spec.json")
        entities = erd.get("entities")
        assert isinstance(entities, list), "`entities` must be an array"
    
        for i, ent in enumerate(entities):
            fields = ent.get("fields")
>           assert isinstance(fields, list), f"entities[{i}].fields must be an array"
E           AssertionError: entities[0].fields must be an array
E           assert False
E            +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)

tests/architectural/test_epic_a_data_model_architecture.py:200: AssertionError
________________ test_entity_field_names_are_unique_per_entity _________________

    def test_entity_field_names_are_unique_per_entity() -> None:
        """Verifies 7.1.3 — no duplicate field names within an entity."""
        erd = _read_json(DOCS / "erd_spec.json")
        for i, ent in enumerate(erd.get("entities", [])):
>           assert isinstance(ent.get("fields"), list), f"entities[{i}].fields must be an array"
E           AssertionError: entities[0].fields must be an array
E           assert False
E            +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)
E            +    where {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'} = <built-in method get of dict object at 0x7fbfa01ae6c0>('fields')
E            +      where <built-in method get of dict object at 0x7fbfa01ae6c0> = {'fields': {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, 'name': 'Company', 'pk': {'company_id': 'uuid:not_null'}}.get

tests/architectural/test_epic_a_data_model_architecture.py:213: AssertionError
_________________ test_migration_column_types_match_erd_types __________________

    def test_migration_column_types_match_erd_types() -> None:
        """Verifies 7.1.4 — migration column types correspond to ERD field types."""
        erd = _read_json(DOCS / "erd_spec.json")
        sql_path = MIGRATIONS / "001_init.sql"
        assert sql_path.exists(), "migrations/001_init.sql must exist"
        sql = _read_text(sql_path)
        tables = _extract_create_table_columns(sql)
    
        for ent in erd.get("entities", []):
            assert isinstance(ent.get("name"), str) and ent["name"].strip(), "Entity must have name"
>           assert isinstance(ent.get("fields"), list), f"Entity {ent.get('name')} must declare fields[]"
E           AssertionError: Entity Company must declare fields[]
E           assert False
E            +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)
E            +    where {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'} = <built-in method get of dict object at 0x7fbfa019a840>('fields')
E            +      where <built-in method get of dict object at 0x7fbfa019a840> = {'fields': {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, 'name': 'Company', 'pk': {'company_id': 'uuid:not_null'}}.get

tests/architectural/test_epic_a_data_model_architecture.py:230: AssertionError
_______________ test_sensitive_fields_include_encrypted_boolean ________________

    def test_sensitive_fields_include_encrypted_boolean() -> None:
        """Verifies 7.1.5 — sensitive fields include `encrypted` boolean and values are correct."""
        erd = _read_json(DOCS / "erd_spec.json")
        for ent in erd.get("entities", []):
            fields = ent.get("fields")
>           assert isinstance(fields, list), "fields must be an array of objects"
E           AssertionError: fields must be an array of objects
E           assert False
E            +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)

tests/architectural/test_epic_a_data_model_architecture.py:252: AssertionError
_______________ test_indexes_declared_and_created_by_migrations ________________

    def test_indexes_declared_and_created_by_migrations() -> None:
        """Verifies 7.1.9 — indexes have name and columns and exist in 003."""
        erd = _read_json(DOCS / "erd_spec.json")
        sql = _read_text(MIGRATIONS / "003_indexes.sql")
        create_index_cols = [
            (m.group(1).lower(), m.group(2).lower(), m.group(3).replace(" ", "").lower())
            for m in re.finditer(
                r"CREATE\s+INDEX\s+(?:IF\s+NOT\s+EXISTS\s+)?(\w+)\s+ON\s+(\w+)\s*\(([^)]*)\);",
                sql, re.IGNORECASE)
        ]
        for ent in erd.get("entities", []):
            for ix in ent.get("indexes", []):
>               assert isinstance(ix.get("name"), str) and ix["name"].strip(), "Index must have name"
E               AttributeError: 'str' object has no attribute 'get'

tests/architectural/test_epic_a_data_model_architecture.py:335: AttributeError
_________________ test_enums_centralised_with_names_and_values _________________

    def test_enums_centralised_with_names_and_values() -> None:
        """Verifies 7.1.10 — ERD includes enums[] with name and values, and SQL defines them."""
        erd = _read_json(DOCS / "erd_spec.json")
>       assert isinstance(erd.get("enums"), list) and erd["enums"], "ERD must include enums[] with entries"
E       AssertionError: ERD must include enums[] with entries
E       assert (False)
E        +  where False = isinstance(None, list)
E        +    where None = <built-in method get of dict object at 0x7fbfa0041740>('enums')
E        +      where <built-in method get of dict object at 0x7fbfa0041740> = {'conventions': {'db_case': 'snake_case', 'entities_case': 'CamelCase', 'enums': {'answer_kind': ['boolean', 'enum_sin...r_code with partial unique index.', 'answer_kind includes enum_single for single-choice questions.'], 'version': '0.3'}.get

tests/architectural/test_epic_a_data_model_architecture.py:348: AssertionError
_________________ test_global_encrypted_field_manifest_exists __________________

    def test_global_encrypted_field_manifest_exists() -> None:
        """Verifies 7.1.11 — encrypted_fields[] manifest exists and is complete."""
        erd = _read_json(DOCS / "erd_spec.json")
        manifest = erd.get("encrypted_fields")
>       assert isinstance(manifest, list), "encrypted_fields[] manifest must exist"
E       AssertionError: encrypted_fields[] manifest must exist
E       assert False
E        +  where False = isinstance(None, list)

tests/architectural/test_epic_a_data_model_architecture.py:368: AssertionError
___________________ test_global_constraints_manifest_exists ____________________

    def test_global_constraints_manifest_exists() -> None:
        """Verifies 7.1.12 — constraints_applied[] enumerates all applied constraints comprehensively.
    
        Asserts non-empty, string-only, and equals the union of identifiers declared in ERD and constraints SQL.
        """
        erd = _read_json(DOCS / "erd_spec.json")
        manifest = erd.get("constraints_applied")
>       assert isinstance(manifest, list), "constraints_applied[] must exist"
E       AssertionError: constraints_applied[] must exist
E       assert False
E        +  where False = isinstance(None, list)

tests/architectural/test_epic_a_data_model_architecture.py:387: AssertionError
__________________ test_migration_journal_structure_is_stable __________________

    def test_migration_journal_structure_is_stable() -> None:
        """Verifies 7.1.13 — journal file exists and entries have filename/applied_at."""
        # Allow multiple possible locations; require at least one present
        candidates = [MIGRATIONS / "_journal.json", Path("_journal.json")]
        present = [p for p in candidates if p.exists()]
>       assert present, "Migration journal artefact must exist (e.g., migrations/_journal.json)"
E       AssertionError: Migration journal artefact must exist (e.g., migrations/_journal.json)
E       assert []

tests/architectural/test_epic_a_data_model_architecture.py:415: AssertionError
______________ test_collections_are_in_deterministic_sorted_order ______________

    def test_collections_are_in_deterministic_sorted_order() -> None:
        """Verifies 7.1.14 — collections are deterministically ordered in ERD and parity exports."""
        erd = _read_json(DOCS / "erd_spec.json")
        mermaid = _read_text(DOCS / "erd_mermaid.md")
        rel_rows = _read_csv_rows(DOCS / "erd_relationships.csv")
    
        # Entities sorted by canonical name
        entities = [e.get("name", "") for e in erd.get("entities", [])]
>       assert entities == sorted(entities), "ERD entities should be sorted by name deterministically"
E       AssertionError: ERD entities should be sorted by name deterministically
E       assert ['Company', '...onseSet', ...] == ['AnswerOptio...ldGroup', ...]
E         
E         At index 0 diff: 'Company' != 'AnswerOption'
E         
E         Full diff:
E           [
E         +     'Company',
E         +     'QuestionnaireQuestion',
E               'AnswerOption',
E         -     'Company',
E               'FieldGroup',
E         +     'QuestionToFieldGroup',
E         +     'ResponseSet',
E         +     'Response',
E         +     'GroupValue',
E               'GeneratedDocument',
E         -     'GroupValue',
E         -     'QuestionToFieldGroup',
E         -     'QuestionnaireQuestion',
E         -     'Response',
E         -     'ResponseSet',
E           ]

tests/architectural/test_epic_a_data_model_architecture.py:437: AssertionError
________________ test_placeholder_lookup_artifacts_are_present _________________

    def test_placeholder_lookup_artifacts_are_present() -> None:
        """Verifies 7.1.15 — direct lookup placeholder artifacts exist and no legacy join artefacts."""
        erd = _read_json(DOCS / "erd_spec.json")
        # ERD includes QuestionnaireQuestion with optional placeholder_code field
        qq = next((e for e in erd.get("entities", []) if e.get("name") == "QuestionnaireQuestion"), None)
        assert qq is not None, "ERD must include entity QuestionnaireQuestion"
        fields = {f.get("name") for f in (qq.get("fields") or []) if isinstance(f, dict)}
>       assert "placeholder_code" in fields, "QuestionnaireQuestion must include optional placeholder_code field"
E       AssertionError: QuestionnaireQuestion must include optional placeholder_code field
E       assert 'placeholder_code' in set()

tests/architectural/test_epic_a_data_model_architecture.py:491: AssertionError
__________ test_structural_constraints_for_responses_and_placeholders __________

    def test_structural_constraints_for_responses_and_placeholders() -> None:
        """Verifies 7.1.16 — one-response-per-question-per-submission and no duplicate placeholders."""
        erd = _read_json(DOCS / "erd_spec.json")
        sql = _read_text(MIGRATIONS / "002_constraints.sql")
    
        # ERD defines composite unique on Response(response_set_id, question_id)
        response = next((e for e in erd.get("entities", []) if e.get("name") == "Response"), None)
        assert response is not None, "ERD must include entity Response"
        uniques = response.get("unique") or []
>       assert any(u.get("columns") == ["response_set_id", "question_id"] for u in uniques if isinstance(u, dict)), (
            "ERD must define composite unique on Response(response_set_id, question_id)"
        )
E       AssertionError: ERD must define composite unique on Response(response_set_id, question_id)
E       assert False
E        +  where False = any(<generator object test_structural_constraints_for_responses_and_placeholders.<locals>.<genexpr> at 0x7fbfa004a8f0>)

tests/architectural/test_epic_a_data_model_architecture.py:518: AssertionError
________________ test_tls_requirement_exposed_as_configuration _________________

    def test_tls_requirement_exposed_as_configuration() -> None:
        """Verifies 7.1.17 — configuration key for TLS enforcement exists and is boolean."""
        key_path = CONFIG / "database.ssl.required"
>       assert key_path.exists(), "config/database.ssl.required must exist"
E       AssertionError: config/database.ssl.required must exist
E       assert False
E        +  where False = exists()
E        +    where exists = PosixPath('config/database.ssl.required').exists

tests/architectural/test_epic_a_data_model_architecture.py:538: AssertionError
_________________ test_column_level_encryption_is_configurable _________________

    def test_column_level_encryption_is_configurable() -> None:
        """Verifies 7.1.18 — encryption.mode allowed values; kms.key_alias required when mode includes column."""
        mode_path = CONFIG / "encryption.mode"
>       assert mode_path.exists(), "config/encryption.mode must exist"
E       AssertionError: config/encryption.mode must exist
E       assert False
E        +  where False = exists()
E        +    where exists = PosixPath('config/encryption.mode').exists

tests/architectural/test_epic_a_data_model_architecture.py:547: AssertionError
__________ test_rollback_scripts_present_and_reverse_prior_migrations __________

    def test_rollback_scripts_present_and_reverse_prior_migrations() -> None:
        """Verifies 7.1.20 — rollback script reverses objects in strict reverse creation order."""
        rb_path = MIGRATIONS / "004_rollbacks.sql"
        assert rb_path.exists(), "migrations/004_rollbacks.sql must exist"
        rb_sql = _read_text(rb_path)
    
        # Keep presence check for table drops
        created_tables_aggregate = (
            [m.group(1).lower() for m in re.finditer(r"CREATE\s+TABLE\s+(?:IF\s+NOT\s+EXISTS\s+)?(\w+)", _read_text(MIGRATIONS / "001_init.sql"), re.IGNORECASE)]
        )
        for t in set(created_tables_aggregate):
            assert re.search(rf"DROP\s+TABLE\s+(?:IF\s+EXISTS\s+)?{re.escape(t)}\b", rb_sql, re.IGNORECASE), (
                f"Rollback must drop table: {t}"
            )
    
        # Extract created objects in order and ensure DROP statements follow strict reverse order
        created_objects = _collect_created_objects_from_migrations()
        assert created_objects, "No created objects detected from 001–003; check migrations present"
    
        def _drop_pos(kind: str, name: str) -> int:
            if kind == "table":
                pat = rf"DROP\s+TABLE\s+(?:IF\s+EXISTS\s+)?{re.escape(name)}\b"
            elif kind == "index":
                pat = rf"DROP\s+INDEX\s+(?:IF\s+EXISTS\s+)?{re.escape(name)}\b"
            elif kind == "constraint":
                pat = rf"DROP\s+CONSTRAINT\s+{re.escape(name)}\b"
            else:
                pat = None
            if not pat:
                return -1
            m = re.search(pat, rb_sql, re.IGNORECASE)
            assert m is not None, f"Rollback must drop {kind} named {name}"
            return m.start()
    
>       positions = [_drop_pos(k, n) for k, n in reversed(created_objects)]

tests/architectural/test_epic_a_data_model_architecture.py:604: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/architectural/test_epic_a_data_model_architecture.py:604: in <listcomp>
    positions = [_drop_pos(k, n) for k, n in reversed(created_objects)]
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

kind = 'constraint', name = 'uq_question_external_qid'

    def _drop_pos(kind: str, name: str) -> int:
        if kind == "table":
            pat = rf"DROP\s+TABLE\s+(?:IF\s+EXISTS\s+)?{re.escape(name)}\b"
        elif kind == "index":
            pat = rf"DROP\s+INDEX\s+(?:IF\s+EXISTS\s+)?{re.escape(name)}\b"
        elif kind == "constraint":
            pat = rf"DROP\s+CONSTRAINT\s+{re.escape(name)}\b"
        else:
            pat = None
        if not pat:
            return -1
        m = re.search(pat, rb_sql, re.IGNORECASE)
>       assert m is not None, f"Rollback must drop {kind} named {name}"
E       AssertionError: Rollback must drop constraint named uq_question_external_qid
E       assert None is not None

tests/architectural/test_epic_a_data_model_architecture.py:601: AssertionError
_________________ test_generated_document_storage_is_modelled __________________

    def test_generated_document_storage_is_modelled() -> None:
        """Verifies 7.1.21 — model contains generated document entity with id and output_uri; DDL present."""
        erd = _read_json(DOCS / "erd_spec.json")
        gen = next((e for e in erd.get("entities", []) if e.get("name") == "GeneratedDocument"), None)
        assert gen is not None, "ERD must include entity GeneratedDocument"
        fields = {f.get("name") for f in (gen.get("fields") or []) if isinstance(f, dict)}
>       assert "generated_document_id" in fields or "id" in fields, "GeneratedDocument must have stable identifier field"
E       AssertionError: GeneratedDocument must have stable identifier field
E       assert ('generated_document_id' in set() or 'id' in set())

tests/architectural/test_epic_a_data_model_architecture.py:618: AssertionError
________________ test_encrypted_fields_trace_to_global_manifest ________________

    def test_encrypted_fields_trace_to_global_manifest() -> None:
        """Verifies 7.1.25 — Entity.field set for encrypted columns equals encrypted_fields[]."""
        erd = _read_json(DOCS / "erd_spec.json")
        from_entities: Set[str] = set()
        for ent in erd.get("entities", []):
            for f in ent.get("fields", []) or []:
                if isinstance(f, dict) and f.get("encrypted") is True:
                    from_entities.add(f"{ent.get('name')}.{f.get('name')}")
        manifest = erd.get("encrypted_fields")
>       assert isinstance(manifest, list), "encrypted_fields[] must exist"
E       AssertionError: encrypted_fields[] must exist
E       assert False
E        +  where False = isinstance(None, list)

tests/architectural/test_epic_a_data_model_architecture.py:652: AssertionError
___________ test_constraints_and_indexes_live_in_migrations_not_code ___________

    def test_constraints_and_indexes_live_in_migrations_not_code() -> None:
        """Verifies 7.1.26 — constraints/indexes defined in migrations; none in application code."""
        # Presence in SQL files
        for fname in ("001_init.sql", "002_constraints.sql", "003_indexes.sql"):
            path = MIGRATIONS / fname
            assert path.exists(), f"{path} must exist"
            sql = _read_text(path)
            assert re.search(r"\b(CREATE\s+TABLE|CREATE\s+INDEX|ALTER\s+TABLE|CONSTRAINT)\b", sql, re.IGNORECASE), (
                f"DDL tokens should be present in {fname}"
            )
        # Absence in application source code
        offenders = _ddl_tokens_present_outside_migrations()
>       assert not offenders, f"DDL tokens must not appear outside migrations: {offenders}"
E       AssertionError: DDL tokens must not appear outside migrations: [(PosixPath('tests/architectural/test_epic_a_data_model_architecture.py'), '\\bCREATE\\s+TABLE\\b'), (PosixPath('tests/functional/test_epic_a_data_model_functional.py'), '\\bCONSTRAINT\\b')]
E       assert not [(PosixPath('tests/architectural/test_epic_a_data_model_architecture.py'), '\\bCREATE\\s+TABLE\\b'), (PosixPath('tests/functional/test_epic_a_data_model_functional.py'), '\\bCONSTRAINT\\b')]

tests/architectural/test_epic_a_data_model_architecture.py:669: AssertionError
_____ test_placeholder_uniqueness_enforced_via_partial_unique_on_questions _____

    def test_placeholder_uniqueness_enforced_via_partial_unique_on_questions() -> None:
        """Verifies 7.1.27 — partial unique on QuestionnaireQuestion(placeholder_code) non-null only."""
        erd = _read_json(DOCS / "erd_spec.json")
        qq = next((e for e in erd.get("entities", []) if e.get("name") == "QuestionnaireQuestion"), None)
        assert qq is not None, "ERD must include entity QuestionnaireQuestion"
        uniqs = qq.get("unique") or []
>       assert any(
            u.get("columns") == ["placeholder_code"] and (u.get("where") or "").lower().strip() in {"placeholder_code is not null", "placeholder_code!=null"}
            for u in uniqs if isinstance(u, dict)
        ), "ERD must define partial unique on QuestionnaireQuestion(placeholder_code) where placeholder_code IS NOT NULL"
E       AssertionError: ERD must define partial unique on QuestionnaireQuestion(placeholder_code) where placeholder_code IS NOT NULL
E       assert False
E        +  where False = any(<generator object test_placeholder_uniqueness_enforced_via_partial_unique_on_questions.<locals>.<genexpr> at 0x7fbfa0093450>)

tests/architectural/test_epic_a_data_model_architecture.py:679: AssertionError
____________ test_one_response_per_question_per_submission_enforced ____________

    def test_one_response_per_question_per_submission_enforced() -> None:
        """Verifies 7.1.28 — composite unique (response_set_id, question_id) exists in ERD and SQL."""
        erd = _read_json(DOCS / "erd_spec.json")
        resp = next((e for e in erd.get("entities", []) if e.get("name") == "Response"), None)
        assert resp is not None, "ERD must include entity Response"
        uniqs = resp.get("unique") or []
>       assert any(u.get("columns") == ["response_set_id", "question_id"] for u in uniqs if isinstance(u, dict)), (
            "ERD must define composite unique on Response(response_set_id, question_id)"
        )
E       AssertionError: ERD must define composite unique on Response(response_set_id, question_id)
E       assert False
E        +  where False = any(<generator object test_one_response_per_question_per_submission_enforced.<locals>.<genexpr> at 0x7fbfa00c2d50>)

tests/architectural/test_epic_a_data_model_architecture.py:696: AssertionError
________________ test_erd_parity_exports_correspond_to_erd_spec ________________

    def test_erd_parity_exports_correspond_to_erd_spec() -> None:
        """Verifies 7.1.29 — Mermaid and CSV mirror ERD entities and relationships only."""
        erd = _read_json(DOCS / "erd_spec.json")
        mermaid = _read_text(DOCS / "erd_mermaid.md")
        rows = _read_csv_rows(DOCS / "erd_relationships.csv")
        # Assume CSV header: source,target or similar; detect columns by names
        header = [h.strip().lower() for h in rows[0]] if rows else []
        assert rows and header, "relationships CSV must be non-empty with header"
        # heuristics for columns
        try:
            src_idx = header.index("source")
            dst_idx = header.index("target")
        except ValueError:
            # fallback to first two columns
            src_idx, dst_idx = 0, 1
    
        csv_entities: Set[str] = set()
        csv_relationships: Set[Tuple[str, str]] = set()
        for r in rows[1:]:
            if len(r) <= max(src_idx, dst_idx):
                continue
            s, t = r[src_idx].strip(), r[dst_idx].strip()
            if s and t:
                csv_relationships.add((s, t))
                csv_entities.update({s, t})
    
        erd_entities = {e.get("name") for e in erd.get("entities", []) if isinstance(e, dict)}
    
        # Mermaid edges like: A --> B ; or A -- FK --> B; collect pairs
        mermaid_edges = set()
        for line in mermaid.splitlines():
            m = re.search(r"(\w+)\s*[-.]{2,}>\s*(\w+)", line)
            if m:
                mermaid_edges.add((m.group(1), m.group(2)))
    
        # Every ERD entity appears in Mermaid and CSV
>       assert erd_entities.issubset(csv_entities), "All ERD entities must appear in relationships CSV"
E       AssertionError: All ERD entities must appear in relationships CSV
E       assert False
E        +  where False = <built-in method issubset of set object at 0x7fbfa04a6ce0>({'Company', 'ContractTemplate', 'QuestionnaireQuestion', 'QuestionnaireScreen', 'ResponseSet', 'ScreenGroup', ...})
E        +    where <built-in method issubset of set object at 0x7fbfa04a6ce0> = {'AnswerOption', 'Company', 'FieldGroup', 'GeneratedDocument', 'GroupValue', 'QuestionToFieldGroup', ...}.issubset

tests/architectural/test_epic_a_data_model_architecture.py:742: AssertionError
_____________ test_contract_7_2_1_1_entities_have_canonical_names ______________

    def test_contract_7_2_1_1_entities_have_canonical_names():
        """Verifies 7.2.1.1 — Entities are persisted with canonical names."""
        outputs = get_outputs_snapshot()["outputs"]
        expected_names = [
            "AnswerOption",
            "Company",
            "FieldGroup",
            "GeneratedDocument",
            "GroupValue",
            "QuestionToFieldGroup",
            "QuestionnaireQuestion",
            "Response",
            "ResponseSet",
        ]
        # Assert: all expected names appear exactly once (set equality)
>       assert outputs is not None and "entities" in outputs  # structural presence
E       assert (None is not None)

tests/functional/test_epic_a_data_model_functional.py:223: AssertionError
_______ test_contract_7_2_1_2_entity_fields_exposed_with_declared_types ________

    def test_contract_7_2_1_2_entity_fields_exposed_with_declared_types():
        """Verifies 7.2.1.2 — All entities expose exact field sets and SQL types."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None and "entities" in outputs
E       assert (None is not None)

tests/functional/test_epic_a_data_model_functional.py:235: AssertionError
____________ test_contract_7_2_1_3_primary_key_externally_declared _____________

    def test_contract_7_2_1_3_primary_key_externally_declared():
        """Verifies 7.2.1.3 — Primary keys declared for all entities with exact columns."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None and "entities" in outputs
E       assert (None is not None)

tests/functional/test_epic_a_data_model_functional.py:255: AssertionError
__________________ test_contract_7_2_1_4_foreign_keys_present __________________

    def test_contract_7_2_1_4_foreign_keys_present():
        """Verifies 7.2.1.4 — All required foreign keys are present across entities."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None and "entities" in outputs
E       assert (None is not None)

tests/functional/test_epic_a_data_model_functional.py:273: AssertionError
_______________ test_contract_7_2_1_5_unique_constraints_present _______________

    def test_contract_7_2_1_5_unique_constraints_present():
        """Verifies 7.2.1.5 — Required unique constraints exist across entities."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None and "entities" in outputs
E       assert (None is not None)

tests/functional/test_epic_a_data_model_functional.py:296: AssertionError
____________________ test_contract_7_2_1_6_indexes_present _____________________

    def test_contract_7_2_1_6_indexes_present():
        """Verifies 7.2.1.6 — Partial unique on QuestionnaireQuestion.placeholder_code (non-null)."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None and "entities" in outputs
E       assert (None is not None)

tests/functional/test_epic_a_data_model_functional.py:315: AssertionError
_____________________ test_contract_7_2_1_7_enums_declared _____________________

    def test_contract_7_2_1_7_enums_declared():
        """Verifies 7.2.1.7 — answer_kind enum is exposed with values."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:332: AssertionError
________________ test_contract_7_2_1_8_encrypted_fields_flagged ________________

    def test_contract_7_2_1_8_encrypted_fields_flagged():
        """Verifies 7.2.1.8 — All fields reflect ERD encryption flags exactly."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:343: AssertionError
____________ test_contract_7_2_1_9_global_encrypted_manifest_exists ____________

    def test_contract_7_2_1_9_global_encrypted_manifest_exists():
        """Verifies 7.2.1.9 — outputs.encrypted_fields lists fully-qualified columns."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:365: AssertionError
______________ test_contract_7_2_1_10_constraints_listed_globally ______________

    def test_contract_7_2_1_10_constraints_listed_globally():
        """Verifies 7.2.1.10 — outputs.constraints_applied includes key identifiers."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:381: AssertionError
_________ test_contract_7_2_1_11_migration_journal_includes_filenames __________

    def test_contract_7_2_1_11_migration_journal_includes_filenames():
        """Verifies 7.2.1.11 — outputs.migration_journal[].filename correctness."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:391: AssertionError
_________ test_contract_7_2_1_12_migration_journal_includes_timestamps _________

    def test_contract_7_2_1_12_migration_journal_includes_timestamps():
        """Verifies 7.2.1.12 — outputs.migration_journal[].applied_at timestamps."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:404: AssertionError
_______ test_contract_7_2_1_13_one_response_per_question_per_submission ________

    def test_contract_7_2_1_13_one_response_per_question_per_submission():
        """Verifies 7.2.1.13 — unique constraint projects the rule for Response."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:416: AssertionError
____ test_contract_7_2_1_14_duplicate_placeholders_rejected_via_uniqueness _____

    def test_contract_7_2_1_14_duplicate_placeholders_rejected_via_uniqueness():
        """Verifies 7.2.1.14 — placeholder_code unique when present; no join entity."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:430: AssertionError
__________ test_contract_7_2_1_15_direct_lookup_structural_visibility __________

    def test_contract_7_2_1_15_direct_lookup_structural_visibility():
        """Verifies 7.2.1.15 — direct lookup via placeholder_code without join entities."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:447: AssertionError
__________ test_contract_7_2_1_16_tls_enforcement_externally_visible ___________

    def test_contract_7_2_1_16_tls_enforcement_externally_visible():
        """Verifies 7.2.1.16 — TLS enforcement surfaced in configuration outputs."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:460: AssertionError
__________ test_contract_7_2_1_17_deterministic_ordering_of_artefacts __________

    def test_contract_7_2_1_17_deterministic_ordering_of_artefacts():
        """Verifies 7.2.1.17 — deterministic ordering across entities, fields, and journal."""
        outputs = get_outputs_snapshot()["outputs"]
>       assert outputs is not None
E       assert None is not None

tests/functional/test_epic_a_data_model_functional.py:469: AssertionError
___________ test_behaviour_7_3_1_1_tables_created_after_runner_start ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa048a5c0>

    def test_behaviour_7_3_1_1_tables_created_after_runner_start(mocker):
        """Verifies 7.3.1.1 — table creation is invoked after migration runner starts."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: create_tables occurs once and only after runner.start
>       assert events.count("create_tables") == 1  # exactly once
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa01f3f80>('create_tables')
E        +    where <built-in method count of list object at 0x7fbfa01f3f80> = [].count

tests/functional/test_epic_a_data_model_functional.py:492: AssertionError
_______________ test_behaviour_7_3_1_2_constraints_follow_tables _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9fffdd50>

    def test_behaviour_7_3_1_2_constraints_follow_tables(mocker):
        """Verifies 7.3.1.2 — constraint creation follows table creation."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: create_constraints occurs once and after create_tables
>       assert events.count("create_constraints") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa0054ac0>('create_constraints')
E        +    where <built-in method count of list object at 0x7fbfa0054ac0> = [].count

tests/functional/test_epic_a_data_model_functional.py:501: AssertionError
____________ test_behaviour_7_3_1_3_encryption_follows_constraints _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff71330>

    def test_behaviour_7_3_1_3_encryption_follows_constraints(mocker):
        """Verifies 7.3.1.3 — encryption application follows constraint creation."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: apply_encryption occurs once and after create_constraints
>       assert events.count("apply_encryption") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa04844c0>('apply_encryption')
E        +    where <built-in method count of list object at 0x7fbfa04844c0> = [].count

tests/functional/test_epic_a_data_model_functional.py:510: AssertionError
___________________ test_behaviour_7_3_1_4_tls_before_db_ops ___________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0479f90>

    def test_behaviour_7_3_1_4_tls_before_db_ops(mocker):
        """Verifies 7.3.1.4 — TLS session established before any DB operation."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: tls.established appears before any db.* operation (e.g., db.execute)
        first_db_op = min((i for i, e in enumerate(events) if e.startswith("db.")), default=-1)
>       assert events.count("tls.established") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa008f980>('tls.established')
E        +    where <built-in method count of list object at 0x7fbfa008f980> = [].count

tests/functional/test_epic_a_data_model_functional.py:520: AssertionError
_______________ test_behaviour_7_3_1_5_row_validation_after_tls ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ffb7520>

    def test_behaviour_7_3_1_5_row_validation_after_tls(mocker):
        """Verifies 7.3.1.5 — row validation is performed after secure connection."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: validate.row occurs once and after tls.established
>       assert events.count("validate.row") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa0199340>('validate.row')
E        +    where <built-in method count of list object at 0x7fbfa0199340> = [].count

tests/functional/test_epic_a_data_model_functional.py:529: AssertionError
____________ test_behaviour_7_3_1_6_direct_lookup_after_validation _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4ded0>

    def test_behaviour_7_3_1_6_direct_lookup_after_validation(mocker):
        """Verifies 7.3.1.6 — direct placeholder lookup follows row validation."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: lookup.placeholder occurs once and after validate.row
>       assert events.count("lookup.placeholder") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa0209bc0>('lookup.placeholder')
E        +    where <built-in method count of list object at 0x7fbfa0209bc0> = [].count

tests/functional/test_epic_a_data_model_functional.py:538: AssertionError
________________ test_behaviour_7_3_1_7_resolution_after_lookup ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff59b10>

    def test_behaviour_7_3_1_7_resolution_after_lookup(mocker):
        """Verifies 7.3.1.7 — placeholder resolution follows direct lookup."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: resolve.placeholders occurs once and after lookup.placeholder
>       assert events.count("resolve.placeholders") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa0041840>('resolve.placeholders')
E        +    where <built-in method count of list object at 0x7fbfa0041840> = [].count

tests/functional/test_epic_a_data_model_functional.py:547: AssertionError
__________ test_behaviour_7_3_1_8_rollback_immediately_after_failure ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ffb65c0>

    def test_behaviour_7_3_1_8_rollback_immediately_after_failure(mocker):
        """Verifies 7.3.1.8 — rollback initiated immediately after migration failure."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: rollback occurs once and immediately after failure.migration
>       assert events.count("rollback") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa01a08c0>('rollback')
E        +    where <built-in method count of list object at 0x7fbfa01a08c0> = [].count

tests/functional/test_epic_a_data_model_functional.py:556: AssertionError
__________ test_behaviour_7_3_1_9_determinism_gate_precedes_next_step __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0479ea0>

    def test_behaviour_7_3_1_9_determinism_gate_precedes_next_step(mocker):
        """Verifies 7.3.1.9 — determinism check before transitioning to next step."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: determinism.verify occurs once and before step.next
>       assert events.count("determinism.verify") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa027f700>('determinism.verify')
E        +    where <built-in method count of list object at 0x7fbfa027f700> = [].count

tests/functional/test_epic_a_data_model_functional.py:565: AssertionError
_______ test_behaviour_7_3_1_11_template_registration_without_migrations _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff736d0>

    def test_behaviour_7_3_1_11_template_registration_without_migrations(mocker):
        """Verifies 7.3.1.11 — template registration does not invoke migration runner."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: template.register occurs once; migration runner start not present
>       assert events.count("template.register") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa01bb4c0>('template.register')
E        +    where <built-in method count of list object at 0x7fbfa01bb4c0> = [].count

tests/functional/test_epic_a_data_model_functional.py:581: AssertionError
________ test_behaviour_7_3_1_12_policy_registration_without_migrations ________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ffb59f0>

    def test_behaviour_7_3_1_12_policy_registration_without_migrations(mocker):
        """Verifies 7.3.1.12 — policy registration does not invoke migration runner."""
        seq = run_step3_sequence()
        events = seq["events"]
        # Assert: policy.register occurs once; migration runner start not present
>       assert events.count("policy.register") == 1
E       AssertionError: assert 0 == 1
E        +  where 0 = <built-in method count of list object at 0x7fbfa02c4ec0>('policy.register')
E        +    where <built-in method count of list object at 0x7fbfa02c4ec0> = [].count

tests/functional/test_epic_a_data_model_functional.py:590: AssertionError
__________ test_contract_7_2_2_1_erd_spec_file_missing_or_unreadable ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0005780>

>   ???
E   AssertionError

<string>:10: AssertionError
_____________ test_contract_7_2_2_2_erd_spec_contains_invalid_json _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa047be20>

>   ???
E   AssertionError

<string>:11: AssertionError
________________ test_contract_7_2_2_3_erd_spec_schema_mismatch ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0478e50>

>   ???
E   AssertionError

<string>:11: AssertionError
_____________ test_contract_7_2_2_4_mermaid_erd_missing_unreadable _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa047b5b0>

>   ???
E   AssertionError

<string>:10: AssertionError
_________________ test_contract_7_2_2_5_mermaid_erd_not_utf_8 __________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff5bfd0>

>   ???
E   AssertionError

<string>:10: AssertionError
_______________ test_contract_7_2_2_6_mermaid_erd_invalid_syntax _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff5ac80>

>   ???
E   AssertionError

<string>:11: AssertionError
__________ test_contract_7_2_2_7_relationships_csv_missing_unreadable __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9fffdcc0>

>   ???
E   AssertionError

<string>:10: AssertionError
_____________ test_contract_7_2_2_8_relationships_csv_invalid_csv ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa00064d0>

>   ???
E   AssertionError

<string>:10: AssertionError
___________ test_contract_7_2_2_9_relationships_csv_header_mismatch ____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0006290>

>   ???
E   AssertionError

<string>:10: AssertionError
___________ test_contract_7_2_2_10_init_migration_missing_unreadable ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa048afe0>

>   ???
E   AssertionError

<string>:10: AssertionError
______________ test_contract_7_2_2_11_init_migration_invalid_sql _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4dcf0>

>   ???
E   AssertionError

<string>:11: AssertionError
____________ test_contract_7_2_2_12_init_migration_execution_error _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa04837c0>

>   ???
E   AssertionError

<string>:12: AssertionError
_______ test_contract_7_2_2_13_constraints_migration_missing_unreadable ________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0482da0>

>   ???
E   AssertionError

<string>:10: AssertionError
___________ test_contract_7_2_2_14_constraints_migration_invalid_sql ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0481c30>

>   ???
E   AssertionError

<string>:11: AssertionError
_________ test_contract_7_2_2_15_constraints_migration_execution_error _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff73550>

>   ???
E   AssertionError

<string>:12: AssertionError
_________ test_contract_7_2_2_16_indexes_migration_missing_unreadable __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff72680>

>   ???
E   AssertionError

<string>:10: AssertionError
_____________ test_contract_7_2_2_17_indexes_migration_invalid_sql _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049c340>

>   ???
E   AssertionError

<string>:11: AssertionError
___________ test_contract_7_2_2_18_indexes_migration_execution_error ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494820>

>   ???
E   AssertionError

<string>:12: AssertionError
________ test_contract_7_2_2_19_rollbacks_migration_missing_unreadable _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0495600>

>   ???
E   AssertionError

<string>:10: AssertionError
____________ test_contract_7_2_2_20_rollbacks_migration_invalid_sql ____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff85ea0>

>   ???
E   AssertionError

<string>:11: AssertionError
__________ test_contract_7_2_2_21_rollbacks_migration_execution_error __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff84dc0>

>   ???
E   AssertionError

<string>:12: AssertionError
_________________ test_contract_7_2_2_22_database_url_missing __________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff85780>

>   ???
E   AssertionError

<string>:9: AssertionError
_______________ test_contract_7_2_2_23_database_url_invalid_dsn ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff853c0>

>   ???
E   AssertionError

<string>:10: AssertionError
_______________ test_contract_7_2_2_24_database_host_unresolved ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff86d70>

>   ???
E   AssertionError

<string>:10: AssertionError
_______________ test_contract_7_2_2_25_tls_required_flag_missing _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa016c7f0>

>   ???
E   AssertionError

<string>:9: AssertionError
_______________ test_contract_7_2_2_26_tls_required_not_boolean ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff849a0>

>   ???
E   AssertionError

<string>:9: AssertionError
_______ test_contract_7_2_2_27_tls_materials_unavailable_while_required ________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff85330>

>   ???
E   AssertionError

<string>:10: AssertionError
________________ test_contract_7_2_2_28_encryption_mode_missing ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff86620>

>   ???
E   AssertionError

<string>:9: AssertionError
_____________ test_contract_7_2_2_29_encryption_mode_invalid_value _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0140fa0>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_30_kms_key_alias_required_for_column_mode _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0141bd0>

>   ???
E   AssertionError

<string>:9: AssertionError
________________ test_contract_7_2_2_31_kms_key_alias_not_found ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01427d0>

>   ???
E   AssertionError

<string>:11: AssertionError
________________ test_contract_7_2_2_32_kms_get_key_call_failed ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa016e5f0>

>   ???
E   AssertionError

<string>:11: AssertionError
______________ test_contract_7_2_2_33_kms_get_key_schema_mismatch ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0141f30>

>   ???
E   AssertionError

<string>:11: AssertionError
_______________ test_contract_7_2_2_34_kms_get_key_not_immutable _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0140e50>

>   ???
E   AssertionError

<string>:11: AssertionError
______________ test_contract_7_2_2_35_secret_manager_call_failed _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0143ee0>

>   ???
E   AssertionError

<string>:11: AssertionError
________________ test_contract_7_2_2_36_secret_schema_mismatch _________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01e8ca0>

>   ???
E   AssertionError

<string>:11: AssertionError
___________________ test_contract_7_2_2_37_secret_was_logged ___________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0142410>

>   ???
E   AssertionError

<string>:11: AssertionError
_____________ test_contract_7_2_2_38_ca_bundle_missing_unreadable ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff84e20>

>   ???
E   AssertionError

<string>:10: AssertionError
_________________ test_contract_7_2_2_39_ca_bundle_invalid_pem _________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01ebe20>

>   ???
E   AssertionError

<string>:10: AssertionError
_______________ test_contract_7_2_2_40_ca_certificate_not_valid ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa016d870>

>   ???
E   AssertionError

<string>:10: AssertionError
______ test_contract_7_2_2_41_encrypted_fields_policy_missing_unreadable _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa016c910>

>   ???
E   AssertionError

<string>:10: AssertionError
_________ test_contract_7_2_2_42_encrypted_fields_pointers_unresolved __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0142620>

>   ???
E   AssertionError

<string>:10: AssertionError
_____________ test_contract_7_2_2_43_encrypted_field_not_in_entity _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01414e0>

>   ???
E   AssertionError

<string>:9: AssertionError
_______________ test_contract_7_2_2_44_migration_timeout_missing _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01431c0>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_45_migration_timeout_not_positive_integer _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff87c40>

>   ???
E   AssertionError

<string>:9: AssertionError
__________ test_contract_7_2_2_46_runtime_migration_execution_failure __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0141930>

>   ???
E   AssertionError

<string>:10: AssertionError
___________ test_contract_7_2_2_47_runtime_constraint_creation_error ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01404f0>

>   ???
E   AssertionError

<string>:10: AssertionError
____________ test_contract_7_2_2_48_runtime_encryption_apply_error _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0497ac0>

>   ???
E   AssertionError

<string>:12: AssertionError
________________ test_contract_7_2_2_49_runtime_rollback_error _________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0495480>

>   ???
E   AssertionError

<string>:10: AssertionError
_____________ test_contract_7_2_2_50_runtime_tls_connection_error ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff857b0>

>   ???
E   AssertionError

<string>:10: AssertionError
______________ test_contract_7_2_2_51_runtime_row_insertion_error ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049ce20>

>   ???
E   AssertionError

<string>:10: AssertionError
_____________ test_contract_7_2_2_52_runtime_join_resolution_error _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff72fb0>

>   ???
E   AssertionError

<string>:10: AssertionError
____________ test_contract_7_2_2_53_runtime_invalid_encryption_key _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049c4c0>

>   ???
E   AssertionError

<string>:12: AssertionError
___________ test_contract_7_2_2_54_runtime_tls_materials_unavailable ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049d3c0>

>   ???
E   AssertionError

<string>:10: AssertionError
_____________ test_contract_7_2_2_55_runtime_unsupported_data_type _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff727d0>

>   ???
E   AssertionError

<string>:10: AssertionError
____________ test_contract_7_2_2_56_runtime_migration_out_of_order _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01439d0>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_57_runtime_unidentified_error _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494340>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_58_outputs_entities_incomplete ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494160>

>   ???
E   AssertionError

<string>:9: AssertionError
_______ test_contract_7_2_2_59_outputs_entities_order_not_deterministic ________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0496590>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_60_outputs_entities_mutable_within_step __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa04959f0>

>   ???
E   AssertionError

<string>:9: AssertionError
_______________ test_contract_7_2_2_61_outputs_entity_name_empty _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494f40>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_62_outputs_entity_name_mismatch_with_erd _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0143a30>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_63_outputs_entity_name_missing ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049f520>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_64_outputs_fields_set_invalid _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff71b10>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_65_outputs_fields_order_not_deterministic _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049c190>

>   ???
E   AssertionError

<string>:9: AssertionError
_____________ test_contract_7_2_2_66_outputs_fields_array_missing ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0142dd0>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_67_outputs_field_name_mismatch_with_erd __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494b80>

>   ???
E   AssertionError

<string>:9: AssertionError
_____________ test_contract_7_2_2_68_outputs_field_name_not_unique _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff70d00>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_69_outputs_field_name_missing _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0424790>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_70_outputs_field_type_mismatch_with_erd __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff71240>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_71_outputs_field_type_missing _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494b80>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_72_outputs_encrypted_flag_false_when_required _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049cd90>

>   ???
E   AssertionError

<string>:9: AssertionError
_____ test_contract_7_2_2_73_outputs_encrypted_flag_true_when_not_required _____

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa04819f0>

>   ???
E   AssertionError

<string>:9: AssertionError
____________ test_contract_7_2_2_74_outputs_encrypted_flag_missing _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0480ac0>

>   ???
E   AssertionError

<string>:9: AssertionError
_______________ test_contract_7_2_2_75_primary_key_columns_empty _______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049cee0>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_76_primary_key_columns_unknown ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494b80>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_77_primary_key_columns_order_not_deterministic ______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0483b80>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_78_primary_key_columns_missing_when_pk_defined ______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa04828c0>

>   ???
E   AssertionError

<string>:9: AssertionError
_______________ test_contract_7_2_2_79_foreign_keys_set_invalid ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4db70>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_80_foreign_keys_order_not_deterministic __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0483a60>

>   ???
E   AssertionError

<string>:9: AssertionError
________________ test_contract_7_2_2_81_foreign_key_name_empty _________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff72e30>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_82_foreign_key_name_not_unique ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0497f10>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_83_foreign_key_name_missing_when_fks_exist ________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4dc90>

>   ???
E   AssertionError

<string>:9: AssertionError
______________ test_contract_7_2_2_84_foreign_key_columns_unknown ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4f430>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_85_foreign_key_columns_order_not_deterministic ______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0497fa0>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_86_foreign_key_columns_missing_when_fks_exist _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0481750>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_87_foreign_key_references_entity_missing _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4eb00>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_88_foreign_key_references_columns_missing _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4cd00>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_89_foreign_key_references_entity_unknown _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa025f2e0>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_90_foreign_key_references_columns_unknown _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4f970>

>   ???
E   AssertionError

<string>:9: AssertionError
_____ test_contract_7_2_2_91_foreign_key_references_columns_count_mismatch _____

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4e320>

>   ???
E   AssertionError

<string>:9: AssertionError
____________ test_contract_7_2_2_92_unique_constraints_set_invalid _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4ed70>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_93_unique_constraints_order_not_deterministic _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0481f60>

>   ???
E   AssertionError

<string>:9: AssertionError
_____________ test_contract_7_2_2_94_unique_constraint_name_empty ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0482800>

>   ???
E   AssertionError

<string>:9: AssertionError
___________ test_contract_7_2_2_95_unique_constraint_name_not_unique ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049f760>

>   ???
E   AssertionError

<string>:9: AssertionError
___ test_contract_7_2_2_96_unique_constraint_name_missing_when_uniques_exist ___

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa04812d0>

>   ???
E   AssertionError

<string>:9: AssertionError
___________ test_contract_7_2_2_97_unique_constraint_columns_unknown ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4dc60>

>   ???
E   AssertionError

<string>:9: AssertionError
___ test_contract_7_2_2_98_unique_constraint_columns_order_not_deterministic ___

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4d6f0>

>   ???
E   AssertionError

<string>:9: AssertionError
_ test_contract_7_2_2_99_unique_constraint_columns_missing_when_uniques_exist __

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff724d0>

>   ???
E   AssertionError

<string>:9: AssertionError
_________________ test_contract_7_2_2_100_indexes_set_invalid __________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0495780>

>   ???
E   AssertionError

<string>:9: AssertionError
___________ test_contract_7_2_2_101_indexes_order_not_deterministic ____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4e9e0>

>   ???
E   AssertionError

<string>:9: AssertionError
___________________ test_contract_7_2_2_102_index_name_empty ___________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0483b20>

>   ???
E   AssertionError

<string>:9: AssertionError
________________ test_contract_7_2_2_103_index_name_not_unique _________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff70580>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_104_index_name_missing_when_indexes_exist _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0497ac0>

>   ???
E   AssertionError

<string>:9: AssertionError
________________ test_contract_7_2_2_105_index_columns_unknown _________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0495b10>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_106_index_columns_order_not_deterministic _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa04960b0>

>   ???
E   AssertionError

<string>:9: AssertionError
_______ test_contract_7_2_2_107_index_columns_missing_when_indexes_exist _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff704f0>

>   ???
E   AssertionError

<string>:9: AssertionError
___________________ test_contract_7_2_2_108_enums_incomplete ___________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff4ce50>

>   ???
E   AssertionError

<string>:9: AssertionError
____________ test_contract_7_2_2_109_enums_order_not_deterministic _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff84910>

>   ???
E   AssertionError

<string>:9: AssertionError
___________________ test_contract_7_2_2_110_enum_name_empty ____________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01e8c10>

>   ???
E   AssertionError

<string>:9: AssertionError
_____________ test_contract_7_2_2_111_enum_name_mismatch_with_erd ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff84e20>

>   ???
E   AssertionError

<string>:9: AssertionError
__________ test_contract_7_2_2_112_enum_name_missing_when_enums_exist __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa049c3d0>

>   ???
E   AssertionError

<string>:9: AssertionError
__________________ test_contract_7_2_2_113_enum_values_empty ___________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0494a90>

>   ???
E   AssertionError

<string>:9: AssertionError
____________ test_contract_7_2_2_114_enum_values_mismatch_with_erd _____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01e8970>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_115_enum_values_order_not_deterministic __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01ea7d0>

>   ???
E   AssertionError

<string>:9: AssertionError
_________ test_contract_7_2_2_116_enum_values_missing_when_enums_exist _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01eb3d0>

>   ???
E   AssertionError

<string>:9: AssertionError
_____________ test_contract_7_2_2_117_encrypted_fields_incomplete ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff70730>

>   ???
E   AssertionError

<string>:9: AssertionError
__________ test_contract_7_2_2_118_encrypted_fields_values_not_unique __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01eb1f0>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_119_encrypted_fields_present_when_erd_none ________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01e9750>

>   ???
E   AssertionError

<string>:9: AssertionError
____________ test_contract_7_2_2_120_constraints_applied_incomplete ____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01e8ca0>

>   ???
E   AssertionError

<string>:9: AssertionError
___________ test_contract_7_2_2_121_constraints_applied_value_empty ____________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa016f760>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_contract_7_2_2_122_constraints_applied_values_not_unique _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ff727d0>

>   ???
E   AssertionError

<string>:9: AssertionError
_____ test_contract_7_2_2_123_constraints_applied_order_not_deterministic ______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01eb130>

>   ???
E   AssertionError

<string>:9: AssertionError
_______________ test_contract_7_2_2_124_migration_journal_empty ________________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01e9d50>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_125_migration_journal_order_not_deterministic _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa016ca90>

>   ???
E   AssertionError

<string>:9: AssertionError
______ test_contract_7_2_2_126_migration_journal_missing_required_fields _______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa048abc0>

>   ???
E   AssertionError

<string>:9: AssertionError
________ test_behaviour_7_3_2_1_halt_on_migration_execution_error_e1_e2 ________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0481870>

>   ???
E   AssertionError

<string>:10: AssertionError
_____ test_behaviour_7_3_2_2_halt_on_constraint_creation_error_e2_indexes ______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01eb910>

>   ???
E   AssertionError

<string>:10: AssertionError
___ test_behaviour_7_3_2_3_halt_on_encryption_application_error_e3_remainder ___

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa048b2e0>

>   ???
E   AssertionError

<string>:10: AssertionError
______________ test_behaviour_7_3_2_4_halt_on_rollback_failure_e8 ______________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa048a020>

>   ???
E   AssertionError

<string>:10: AssertionError
__________ test_behaviour_7_3_2_5_halt_on_tls_connection_error_e4_e5 ___________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa048b580>

>   ???
E   AssertionError

<string>:10: AssertionError
_____ test_behaviour_7_3_2_6_halt_on_row_insertion_validation_error_e5_e6 ______

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa047b790>

>   ???
E   AssertionError

<string>:10: AssertionError
__________ test_behaviour_7_3_2_7_halt_on_join_resolution_error_e6_e7 __________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa047bca0>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_8_halt_on_invalid_encryption_key_during_field_access_s3 _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0478850>

>   ???
E   AssertionError

<string>:10: AssertionError
________ test_behaviour_7_3_2_9_halt_when_tls_materials_unavailable_e4 _________

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0479000>

>   ???
E   AssertionError

<string>:10: AssertionError
____ test_behaviour_7_3_2_10_halt_on_unsupported_data_type_at_validation_e5 ____

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0007b50>

>   ???
E   AssertionError

<string>:10: AssertionError
__ test_behaviour_7_3_2_11_halt_on_out_of_order_migration_execution_e1_e2_e8 ___

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa00056f0>

>   ???
E   AssertionError

<string>:10: AssertionError
_____ test_behaviour_7_3_2_12_halt_on_unidentified_runtime_error_catch_all _____

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9fffe050>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_13_database_connectivity_failure_halts_step_3_and_prevents_downstream_operations _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9fffc3a0>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_14_database_permission_failure_halts_step_3_and_prevents_schema_creation _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9fffcb50>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_15_tls_certificate_handshake_failure_halts_step_3_and_prevents_inserts _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0004f10>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_16_database_storage_exhaustion_halts_step_3_and_prevents_journal_updates _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa01c5330>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_17_filesystem_temp_unavailability_prevents_step_3_continuation_degraded_stop _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbf9ffff370>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_18_kms_unavailability_halts_step_3_encryption_operations_and_prevents_access _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa0478c70>

>   ???
E   AssertionError

<string>:10: AssertionError
_ test_behaviour_7_3_2_19_time_synchronisation_failure_halts_step_3_where_timestamps_are_required _

self = <unittest.mock._patch object at 0x7fbfa047bcd0>

    def __enter__(self):
        """Perform the patch."""
        new, spec, spec_set = self.new, self.spec, self.spec_set
        autospec, kwargs = self.autospec, self.kwargs
        new_callable = self.new_callable
        self.target = self.getter()
    
        # normalise False to None
        if spec is False:
            spec = None
        if spec_set is False:
            spec_set = None
        if autospec is False:
            autospec = None
    
        if spec is not None and autospec is not None:
            raise TypeError("Can't specify spec and autospec")
        if ((spec is not None or autospec is not None) and
            spec_set not in (True, None)):
            raise TypeError("Can't provide explicit spec_set *and* spec or autospec")
    
        original, local = self.get_original()
    
        if new is DEFAULT and autospec is None:
            inherit = False
            if spec is True:
                # set spec to the object we are replacing
                spec = original
                if spec_set is True:
                    spec_set = original
                    spec = None
            elif spec is not None:
                if spec_set is True:
                    spec_set = spec
                    spec = None
            elif spec_set is True:
                spec_set = original
    
            if spec is not None or spec_set is not None:
                if original is DEFAULT:
                    raise TypeError("Can't use 'spec' with create=True")
                if isinstance(original, type):
                    # If we're patching out a class and there is a spec
                    inherit = True
            if spec is None and _is_async_obj(original):
                Klass = AsyncMock
            else:
                Klass = MagicMock
            _kwargs = {}
            if new_callable is not None:
                Klass = new_callable
            elif spec is not None or spec_set is not None:
                this_spec = spec
                if spec_set is not None:
                    this_spec = spec_set
                if _is_list(this_spec):
                    not_callable = '__call__' not in this_spec
                else:
                    not_callable = not callable(this_spec)
                if _is_async_obj(this_spec):
                    Klass = AsyncMock
                elif not_callable:
                    Klass = NonCallableMagicMock
    
            if spec is not None:
                _kwargs['spec'] = spec
            if spec_set is not None:
                _kwargs['spec_set'] = spec_set
    
            # add a name to mocks
            if (isinstance(Klass, type) and
                issubclass(Klass, NonCallableMock) and self.attribute):
                _kwargs['name'] = self.attribute
    
            _kwargs.update(kwargs)
            new = Klass(**_kwargs)
    
            if inherit and _is_instance_mock(new):
                # we can only tell if the instance should be callable if the
                # spec is not a list
                this_spec = spec
                if spec_set is not None:
                    this_spec = spec_set
                if (not _is_list(this_spec) and not
                    _instance_callable(this_spec)):
                    Klass = NonCallableMagicMock
    
                _kwargs.pop('name')
                new.return_value = Klass(_new_parent=new, _new_name='()',
                                         **_kwargs)
        elif autospec is not None:
            # spec is ignored, new *must* be default, spec_set is treated
            # as a boolean. Should we check spec is not None and that spec_set
            # is a bool?
            if new is not DEFAULT:
                raise TypeError(
                    "autospec creates the mock for you. Can't specify "
                    "autospec and new."
                )
            if original is DEFAULT:
                raise TypeError("Can't use 'autospec' with create=True")
            spec_set = bool(spec_set)
            if autospec is True:
                autospec = original
    
            if _is_instance_mock(self.target):
                raise InvalidSpecError(
                    f'Cannot autospec attr {self.attribute!r} as the patch '
                    f'target has already been mocked out. '
                    f'[target={self.target!r}, attr={autospec!r}]')
            if _is_instance_mock(autospec):
                target_name = getattr(self.target, '__name__', self.target)
                raise InvalidSpecError(
                    f'Cannot autospec attr {self.attribute!r} from target '
                    f'{target_name!r} as it has already been mocked out. '
                    f'[target={self.target!r}, attr={autospec!r}]')
    
            new = create_autospec(autospec, spec_set=spec_set,
                                  _name=self.attribute, **kwargs)
        elif kwargs:
            # can't set keyword args when we aren't creating the mock
            # XXXX If new is a Mock we could call new.configure_mock(**kwargs)
            raise TypeError("Can't pass kwargs to a mock we aren't creating")
    
        new_attr = new
    
        self.temp_original = original
        self.is_local = local
        self._exit_stack = contextlib.ExitStack()
        try:
>           setattr(self.target, self.attribute, new_attr)
E           TypeError: cannot set 'utcnow' attribute of immutable type 'datetime.datetime'

/usr/lib/python3.10/unittest/mock.py:1556: TypeError

During handling of the above exception, another exception occurred:

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa047a740>

>   ???

<string>:7: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../.local/lib/python3.10/site-packages/pytest_mock/plugin.py:439: in __call__
    return self._start_patch(
../.local/lib/python3.10/site-packages/pytest_mock/plugin.py:257: in _start_patch
    mocked: MockType = p.start()
/usr/lib/python3.10/unittest/mock.py:1595: in start
    result = self.__enter__()
/usr/lib/python3.10/unittest/mock.py:1569: in __enter__
    if not self.__exit__(*sys.exc_info()):
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x7fbfa047bcd0>
exc_info = (<class 'TypeError'>, TypeError("cannot set 'utcnow' attribute of immutable type 'datetime.datetime'"), <traceback object at 0x7fbfa0080480>)

    def __exit__(self, *exc_info):
        """Undo the patch."""
        if self.is_local and self.temp_original is not DEFAULT:
>           setattr(self.target, self.attribute, self.temp_original)
E           TypeError: cannot set 'utcnow' attribute of immutable type 'datetime.datetime'

/usr/lib/python3.10/unittest/mock.py:1575: TypeError
_ test_behaviour_7_3_2_20_configuration_dependency_unavailability_prevents_step_3_initiation _

mocker = <pytest_mock.plugin.MockerFixture object at 0x7fbfa047a0e0>

>   ???
E   AssertionError

<string>:10: AssertionError
=============================== warnings summary ===============================
<string>:3
<string>:3
<string>:3
  <string>:3: DeprecationWarning: invalid escape sequence '\_'

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_entities_declare_explicit_field_collections - AssertionError: entities[0].fields must be an array
assert False
 +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_entity_field_names_are_unique_per_entity - AssertionError: entities[0].fields must be an array
assert False
 +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)
 +    where {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'} = <built-in method get of dict object at 0x7fbfa01ae6c0>('fields')
 +      where <built-in method get of dict object at 0x7fbfa01ae6c0> = {'fields': {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, 'name': 'Company', 'pk': {'company_id': 'uuid:not_null'}}.get
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_migration_column_types_match_erd_types - AssertionError: Entity Company must declare fields[]
assert False
 +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)
 +    where {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'} = <built-in method get of dict object at 0x7fbfa019a840>('fields')
 +      where <built-in method get of dict object at 0x7fbfa019a840> = {'fields': {'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, 'name': 'Company', 'pk': {'company_id': 'uuid:not_null'}}.get
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_sensitive_fields_include_encrypted_boolean - AssertionError: fields must be an array of objects
assert False
 +  where False = isinstance({'created_at': 'timestamptz:not_null', 'legal_name': 'text:not_null', 'registered_office_address': 'text', 'updated_at': 'timestamptz'}, list)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_indexes_declared_and_created_by_migrations - AttributeError: 'str' object has no attribute 'get'
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_enums_centralised_with_names_and_values - AssertionError: ERD must include enums[] with entries
assert (False)
 +  where False = isinstance(None, list)
 +    where None = <built-in method get of dict object at 0x7fbfa0041740>('enums')
 +      where <built-in method get of dict object at 0x7fbfa0041740> = {'conventions': {'db_case': 'snake_case', 'entities_case': 'CamelCase', 'enums': {'answer_kind': ['boolean', 'enum_sin...r_code with partial unique index.', 'answer_kind includes enum_single for single-choice questions.'], 'version': '0.3'}.get
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_global_encrypted_field_manifest_exists - AssertionError: encrypted_fields[] manifest must exist
assert False
 +  where False = isinstance(None, list)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_global_constraints_manifest_exists - AssertionError: constraints_applied[] must exist
assert False
 +  where False = isinstance(None, list)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_migration_journal_structure_is_stable - AssertionError: Migration journal artefact must exist (e.g., migrations/_journal.json)
assert []
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_collections_are_in_deterministic_sorted_order - AssertionError: ERD entities should be sorted by name deterministically
assert ['Company', '...onseSet', ...] == ['AnswerOptio...ldGroup', ...]
  
  At index 0 diff: 'Company' != 'AnswerOption'
  
  Full diff:
    [
  +     'Company',
  +     'QuestionnaireQuestion',
        'AnswerOption',
  -     'Company',
        'FieldGroup',
  +     'QuestionToFieldGroup',
  +     'ResponseSet',
  +     'Response',
  +     'GroupValue',
        'GeneratedDocument',
  -     'GroupValue',
  -     'QuestionToFieldGroup',
  -     'QuestionnaireQuestion',
  -     'Response',
  -     'ResponseSet',
    ]
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_placeholder_lookup_artifacts_are_present - AssertionError: QuestionnaireQuestion must include optional placeholder_code field
assert 'placeholder_code' in set()
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_structural_constraints_for_responses_and_placeholders - AssertionError: ERD must define composite unique on Response(response_set_id, question_id)
assert False
 +  where False = any(<generator object test_structural_constraints_for_responses_and_placeholders.<locals>.<genexpr> at 0x7fbfa004a8f0>)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_tls_requirement_exposed_as_configuration - AssertionError: config/database.ssl.required must exist
assert False
 +  where False = exists()
 +    where exists = PosixPath('config/database.ssl.required').exists
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_column_level_encryption_is_configurable - AssertionError: config/encryption.mode must exist
assert False
 +  where False = exists()
 +    where exists = PosixPath('config/encryption.mode').exists
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_rollback_scripts_present_and_reverse_prior_migrations - AssertionError: Rollback must drop constraint named uq_question_external_qid
assert None is not None
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_generated_document_storage_is_modelled - AssertionError: GeneratedDocument must have stable identifier field
assert ('generated_document_id' in set() or 'id' in set())
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_encrypted_fields_trace_to_global_manifest - AssertionError: encrypted_fields[] must exist
assert False
 +  where False = isinstance(None, list)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_constraints_and_indexes_live_in_migrations_not_code - AssertionError: DDL tokens must not appear outside migrations: [(PosixPath('tests/architectural/test_epic_a_data_model_architecture.py'), '\\bCREATE\\s+TABLE\\b'), (PosixPath('tests/functional/test_epic_a_data_model_functional.py'), '\\bCONSTRAINT\\b')]
assert not [(PosixPath('tests/architectural/test_epic_a_data_model_architecture.py'), '\\bCREATE\\s+TABLE\\b'), (PosixPath('tests/functional/test_epic_a_data_model_functional.py'), '\\bCONSTRAINT\\b')]
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_placeholder_uniqueness_enforced_via_partial_unique_on_questions - AssertionError: ERD must define partial unique on QuestionnaireQuestion(placeholder_code) where placeholder_code IS NOT NULL
assert False
 +  where False = any(<generator object test_placeholder_uniqueness_enforced_via_partial_unique_on_questions.<locals>.<genexpr> at 0x7fbfa0093450>)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_one_response_per_question_per_submission_enforced - AssertionError: ERD must define composite unique on Response(response_set_id, question_id)
assert False
 +  where False = any(<generator object test_one_response_per_question_per_submission_enforced.<locals>.<genexpr> at 0x7fbfa00c2d50>)
FAILED tests/architectural/test_epic_a_data_model_architecture.py::test_erd_parity_exports_correspond_to_erd_spec - AssertionError: All ERD entities must appear in relationships CSV
assert False
 +  where False = <built-in method issubset of set object at 0x7fbfa04a6ce0>({'Company', 'ContractTemplate', 'QuestionnaireQuestion', 'QuestionnaireScreen', 'ResponseSet', 'ScreenGroup', ...})
 +    where <built-in method issubset of set object at 0x7fbfa04a6ce0> = {'AnswerOption', 'Company', 'FieldGroup', 'GeneratedDocument', 'GroupValue', 'QuestionToFieldGroup', ...}.issubset
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_1_entities_have_canonical_names - assert (None is not None)
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_2_entity_fields_exposed_with_declared_types - assert (None is not None)
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_3_primary_key_externally_declared - assert (None is not None)
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_4_foreign_keys_present - assert (None is not None)
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_5_unique_constraints_present - assert (None is not None)
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_6_indexes_present - assert (None is not None)
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_7_enums_declared - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_8_encrypted_fields_flagged - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_9_global_encrypted_manifest_exists - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_10_constraints_listed_globally - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_11_migration_journal_includes_filenames - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_12_migration_journal_includes_timestamps - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_13_one_response_per_question_per_submission - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_14_duplicate_placeholders_rejected_via_uniqueness - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_15_direct_lookup_structural_visibility - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_16_tls_enforcement_externally_visible - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_1_17_deterministic_ordering_of_artefacts - assert None is not None
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_1_tables_created_after_runner_start - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa01f3f80>('create_tables')
 +    where <built-in method count of list object at 0x7fbfa01f3f80> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_2_constraints_follow_tables - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa0054ac0>('create_constraints')
 +    where <built-in method count of list object at 0x7fbfa0054ac0> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_3_encryption_follows_constraints - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa04844c0>('apply_encryption')
 +    where <built-in method count of list object at 0x7fbfa04844c0> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_4_tls_before_db_ops - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa008f980>('tls.established')
 +    where <built-in method count of list object at 0x7fbfa008f980> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_5_row_validation_after_tls - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa0199340>('validate.row')
 +    where <built-in method count of list object at 0x7fbfa0199340> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_6_direct_lookup_after_validation - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa0209bc0>('lookup.placeholder')
 +    where <built-in method count of list object at 0x7fbfa0209bc0> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_7_resolution_after_lookup - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa0041840>('resolve.placeholders')
 +    where <built-in method count of list object at 0x7fbfa0041840> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_8_rollback_immediately_after_failure - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa01a08c0>('rollback')
 +    where <built-in method count of list object at 0x7fbfa01a08c0> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_9_determinism_gate_precedes_next_step - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa027f700>('determinism.verify')
 +    where <built-in method count of list object at 0x7fbfa027f700> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_11_template_registration_without_migrations - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa01bb4c0>('template.register')
 +    where <built-in method count of list object at 0x7fbfa01bb4c0> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_1_12_policy_registration_without_migrations - AssertionError: assert 0 == 1
 +  where 0 = <built-in method count of list object at 0x7fbfa02c4ec0>('policy.register')
 +    where <built-in method count of list object at 0x7fbfa02c4ec0> = [].count
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_1_erd_spec_file_missing_or_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_2_erd_spec_contains_invalid_json - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_3_erd_spec_schema_mismatch - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_4_mermaid_erd_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_5_mermaid_erd_not_utf_8 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_6_mermaid_erd_invalid_syntax - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_7_relationships_csv_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_8_relationships_csv_invalid_csv - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_9_relationships_csv_header_mismatch - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_10_init_migration_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_11_init_migration_invalid_sql - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_12_init_migration_execution_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_13_constraints_migration_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_14_constraints_migration_invalid_sql - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_15_constraints_migration_execution_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_16_indexes_migration_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_17_indexes_migration_invalid_sql - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_18_indexes_migration_execution_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_19_rollbacks_migration_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_20_rollbacks_migration_invalid_sql - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_21_rollbacks_migration_execution_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_22_database_url_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_23_database_url_invalid_dsn - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_24_database_host_unresolved - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_25_tls_required_flag_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_26_tls_required_not_boolean - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_27_tls_materials_unavailable_while_required - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_28_encryption_mode_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_29_encryption_mode_invalid_value - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_30_kms_key_alias_required_for_column_mode - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_31_kms_key_alias_not_found - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_32_kms_get_key_call_failed - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_33_kms_get_key_schema_mismatch - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_34_kms_get_key_not_immutable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_35_secret_manager_call_failed - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_36_secret_schema_mismatch - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_37_secret_was_logged - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_38_ca_bundle_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_39_ca_bundle_invalid_pem - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_40_ca_certificate_not_valid - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_41_encrypted_fields_policy_missing_unreadable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_42_encrypted_fields_pointers_unresolved - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_43_encrypted_field_not_in_entity - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_44_migration_timeout_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_45_migration_timeout_not_positive_integer - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_46_runtime_migration_execution_failure - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_47_runtime_constraint_creation_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_48_runtime_encryption_apply_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_49_runtime_rollback_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_50_runtime_tls_connection_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_51_runtime_row_insertion_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_52_runtime_join_resolution_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_53_runtime_invalid_encryption_key - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_54_runtime_tls_materials_unavailable - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_55_runtime_unsupported_data_type - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_56_runtime_migration_out_of_order - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_57_runtime_unidentified_error - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_58_outputs_entities_incomplete - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_59_outputs_entities_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_60_outputs_entities_mutable_within_step - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_61_outputs_entity_name_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_62_outputs_entity_name_mismatch_with_erd - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_63_outputs_entity_name_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_64_outputs_fields_set_invalid - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_65_outputs_fields_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_66_outputs_fields_array_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_67_outputs_field_name_mismatch_with_erd - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_68_outputs_field_name_not_unique - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_69_outputs_field_name_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_70_outputs_field_type_mismatch_with_erd - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_71_outputs_field_type_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_72_outputs_encrypted_flag_false_when_required - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_73_outputs_encrypted_flag_true_when_not_required - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_74_outputs_encrypted_flag_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_75_primary_key_columns_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_76_primary_key_columns_unknown - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_77_primary_key_columns_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_78_primary_key_columns_missing_when_pk_defined - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_79_foreign_keys_set_invalid - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_80_foreign_keys_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_81_foreign_key_name_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_82_foreign_key_name_not_unique - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_83_foreign_key_name_missing_when_fks_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_84_foreign_key_columns_unknown - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_85_foreign_key_columns_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_86_foreign_key_columns_missing_when_fks_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_87_foreign_key_references_entity_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_88_foreign_key_references_columns_missing - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_89_foreign_key_references_entity_unknown - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_90_foreign_key_references_columns_unknown - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_91_foreign_key_references_columns_count_mismatch - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_92_unique_constraints_set_invalid - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_93_unique_constraints_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_94_unique_constraint_name_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_95_unique_constraint_name_not_unique - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_96_unique_constraint_name_missing_when_uniques_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_97_unique_constraint_columns_unknown - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_98_unique_constraint_columns_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_99_unique_constraint_columns_missing_when_uniques_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_100_indexes_set_invalid - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_101_indexes_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_102_index_name_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_103_index_name_not_unique - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_104_index_name_missing_when_indexes_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_105_index_columns_unknown - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_106_index_columns_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_107_index_columns_missing_when_indexes_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_108_enums_incomplete - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_109_enums_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_110_enum_name_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_111_enum_name_mismatch_with_erd - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_112_enum_name_missing_when_enums_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_113_enum_values_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_114_enum_values_mismatch_with_erd - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_115_enum_values_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_116_enum_values_missing_when_enums_exist - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_117_encrypted_fields_incomplete - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_118_encrypted_fields_values_not_unique - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_119_encrypted_fields_present_when_erd_none - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_120_constraints_applied_incomplete - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_121_constraints_applied_value_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_122_constraints_applied_values_not_unique - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_123_constraints_applied_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_124_migration_journal_empty - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_125_migration_journal_order_not_deterministic - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_contract_7_2_2_126_migration_journal_missing_required_fields - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_1_halt_on_migration_execution_error_e1_e2 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_2_halt_on_constraint_creation_error_e2_indexes - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_3_halt_on_encryption_application_error_e3_remainder - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_4_halt_on_rollback_failure_e8 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_5_halt_on_tls_connection_error_e4_e5 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_6_halt_on_row_insertion_validation_error_e5_e6 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_7_halt_on_join_resolution_error_e6_e7 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_8_halt_on_invalid_encryption_key_during_field_access_s3 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_9_halt_when_tls_materials_unavailable_e4 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_10_halt_on_unsupported_data_type_at_validation_e5 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_11_halt_on_out_of_order_migration_execution_e1_e2_e8 - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_12_halt_on_unidentified_runtime_error_catch_all - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_13_database_connectivity_failure_halts_step_3_and_prevents_downstream_operations - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_14_database_permission_failure_halts_step_3_and_prevents_schema_creation - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_15_tls_certificate_handshake_failure_halts_step_3_and_prevents_inserts - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_16_database_storage_exhaustion_halts_step_3_and_prevents_journal_updates - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_17_filesystem_temp_unavailability_prevents_step_3_continuation_degraded_stop - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_18_kms_unavailability_halts_step_3_encryption_operations_and_prevents_access - AssertionError
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_19_time_synchronisation_failure_halts_step_3_where_timestamps_are_required - TypeError: cannot set 'utcnow' attribute of immutable type 'datetime.datetime'
FAILED tests/functional/test_epic_a_data_model_functional.py::test_behaviour_7_3_2_20_configuration_dependency_unavailability_prevents_step_3_initiation - AssertionError
============= 195 failed, 6 passed, 1 skipped, 3 warnings in 2.90s =============
